# CG Homework 1 Teapot

计算机图形学第一次作业报告，作业环境基于助教提供的第一次作业文件包。

exe 文件在/build 目录下。

为了次作业内容进行的具体工作有：

- 研究 camera 在 openGL 中的实现（摄像头的移动）
- 研究 shader 的工作原理（将 shader 应用于物体/环境中）
- 研究模型的导入及导入后的使用方法（模型的位置固定，shader 的应用）
- 研究灯光的工作原理（Ambient，diffuse，specular lighting）

本次作业的实现除了茶壶的自动旋转，茶壶颜色的变化以及背景颜色的变化外，还增加了打光，摄像头的位置变化以及打光（物体）的位置变化。由此来实现物体的颜色随着打光角度的变化而有不同的颜色呈现。

茶壶的颜色呈现除了自身的渐变外还要受打光颜色以及灯光的位置两个因素决定。而背景的颜色则是将茶壶的颜色与打光的颜色相调和并进行了稀释，再结合打光造成的阴影效果，使茶壶即使在颜色相差并不是很多的背景颜色下也能够非常清晰的辨别出来。

## 目录

- [使用说明](#使用说明)
  - [摄像头](#摄像头)
  - [灯光移动](#灯光移动)
  - [灯光调色](#灯光调色)
- [灯光原理](#灯光原理)
- [颜色选取](#颜色选取)
  - [打光颜色](#灯光颜色)
  - [茶壶颜色](#茶壶颜色)
  - [背景颜色](#背景颜色)

## 使用说明

这一章节将说明作业项目使用键盘外设的相关操作。

### 摄像头

项目支持对摄像头进行前后的移动，具体的实现方式为为摄像头设定一个半径，再通过键盘操作改变半径变量的值，并在每次 Loop 循环中使用该半径更新摄像头的 Position。由于我想要实现的是水平面的远近移动，因此每次更新都会更新 Position 三维向量的 x 与 z 分量。

按 W 键可以向茶壶靠近，按 S 键则会远离。

### 灯光移动

项目还支持对灯光的位置进行移动。具体的实现方式为按 A 和 D 键实现水平方向的旋转。

实现原理也较为简单，也是定好一个半径（该半径为灯光所在的 xz 水平面至 y 轴的距离，而非场景中心（0，0，0）的距离）再设定一个偏移角度，使用 A，D 键来改变该角度的值，并在每次刷新时重新使用该角度计算灯光的位置。

### 灯光调色

项目还支持为灯光进行调色，实现方式为按 C 键使其从白光逐渐变暖，按 Z 键使其变回白光。

实现原理为存储一个三维向量变量，并用其三个分量分别代表 RGB 颜色中的红绿蓝的取值。不过在真正进行使用时还是会取此值的余弦值来保证其值在 0.0f 至 1.0f 的数值范围内。

值得一提的是由于在使用过程中如果没有显示灯光颜色，那么实际使用将会非常困难，因此设计了一个立方体来呈现灯光的位置与调色。该立方体的颜色即为此刻灯光的调色。

关于灯光的颜色会在颜色选取的[灯光颜色](#灯光颜色)小节中说明。

## 灯光原理

在这里将对灯光的实现进行详细说明。

为了模拟现实世界中的灯光效果，我们将灯光分了三个类，分别为 Ambient Lighting,Diffuse Lighting 和 Specular Lighting。

Ambient Lighting 指的是即使在极度阴暗的灯光条件下也存在的灯光，这一类灯光会在一定程度上给物体一个基本的色调。

Diffuse Lighting 指的是灯光正常照射在物体上的体现。物体越直接面向这种灯光其效果就越明显。

Specular Lighting 指的是灯光在反射性较强的物体上反射所呈现出来的聚光的灯光效果，具体的灯光呈现跟灯光的相关性更高。

为了贴近茶壶的材质（或者说我个人想呈现的茶壶的材质），在这里我将 Ambient Strength 设置为 0.1，Specular Strength 设置为 0.5.

具体实现参考了[LearnOpenGL](https://learnopengl.com/Lighting/Basic-Lighting)

## 颜色选取

在这里会对项目中所有物体的颜色选取进行详细的描述，其中包括初始值与渐变算法逻辑。

### 打光颜色

首先对与打光颜色，原本的设想是想要 RGB 三种颜色都能进行无限制的调试，即使用按键可以使灯光呈现出任何颜色。不过在实际的使用过程中却发现使用效果并不理想，且我个人比较想要将灯光的调色局限于暖色调的调试，因此在这里是仅仅使用 Z，C 键来实现对 RGB 中蓝色的调试，红色与绿色则一直会是满值的状态。

初始值为（255，255，255），即白光。

![r1](./pics/r1.png)

而由于即使是暖光也是有一定的限制的（再多了呈现效果不佳），我选择将其限制在（蓝色）130 至 255 之间：

![r1](./pics/r2.png)

算法为：

    blue_value = baseVal / 255 + cos(lightcolor.z) / rangeVal

    baseVal = （255 - 取色下线）/ 2 + 取色下线 （这里去色下线为130）

    (（255 - 取色下线）/ 2) / 255 = 1 / rangeVal

    rangeVal = 255 / (（255 - 取色下线）/ 2)

### 茶壶颜色

由于有打光的因素，茶壶的颜色其实取决于茶壶自身的颜色变换和打光的颜色以及打光的角度。

首先茶壶的自身颜色变换我是选择了将 RGB 中绿色取定值 150，再对红色与蓝色在 100 至 200 间相间取值（cos 与 sin）。

限制区域显示颜色的算法与打光颜色的限制是一样的，唯一不同的是对红色取了余弦值，蓝色取了正弦值，导致两种颜色之间相差了限制区域的一半。基值都是 150，但是红色取 cos，初始时 cos（0）= 1， 即 red*value 在初始时取得是 150 + 1 * 50 = 200。而 blue*value = 150 + 0 * 50 = 150。

![r1](./pics/r3.png)

其次由于打光的颜色有变化，我们可以结合颜色的呈现与光的颜色关系，知道物体呈现的颜色与其所吸收到的光的颜色有关。物体在我们的视觉上所呈现的颜色是灯源的各种颜色的灯被物体吸收后所剩下的颜色的反射光的颜色。

![r1](./pics/r4.png)

在本次作业中也实现了这一效果，我们可以看到物体所呈现的颜色会随着灯光颜色的变化而变化。

最后便是灯光的位置所导致的阴影而产生的颜色的变化，具体的实现方式与 Diffuse Lighting 的实现有关，在此不多赘述。

### 背景颜色

背景颜色的渐变实现方式是将茶壶的色调与打光的色调进行 1：1 的结合，计算公式：

- 红色：((150.0f / 255.0f + cos(currentFrame) / 5) / 2 （茶壶颜色） + cos(lightColor.x) / 2 （灯光颜色）
- 绿色：green_value / 2 （茶壶颜色） + cos(lightColor.y) / 2 （灯光颜色）
- 蓝色：(150.0f / 255.0f + sin(currentFrame) / 5) / 2 （茶壶颜色） + ( 185.0f / 255.0f + cos(lightColor.z) / 3.63f) / 2 （灯光颜色）
- 稀释度：0.6

由于我个人比较喜欢背景颜色跟物体是统一色调的，因此我选择了这种实现方式。

在经过多次调试后发现选择 0.6 为稀释度能够更好的在保证背景颜色不过浅的前提下将背景与茶壶分辨开来。

这样的实现方式还有一个优点便是能够在跟茶壶颜色实现统一的情况下又能一定程度的呈现灯光颜色的变化，有一种灯光不仅仅是打在物体上，也大在背景上了的感觉。

打光后：
![r1](./pics/r5.png)

打光前：

![r1](./pics/r6.png)

总体上来说在加入灯光这一因素过后物体和背景的颜色呈现（灯光颜色都参与在了其中）更加的丰富了起来，也使得物体更加立体化，与背景能够很清楚的区分开来。
